<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Room Cycle Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; background:#0f172a; color:#e5e7eb; margin:0; padding:16px; }
h1,h2,h3 { margin:0 0 8px 0; }
.card { background:#020617; border-radius:10px; padding:14px; margin-bottom:14px; }
label { font-size:13px; opacity:0.9; }
input, select, button {
  width:100%; padding:8px; margin-top:4px; margin-bottom:10px;
  border-radius:6px; border:none;
}
button { background:#2563eb; color:white; font-weight:600; }
button.secondary { background:#334155; }
.row { display:flex; gap:8px; }
.row > div { flex:1; }
.small { font-size:12px; opacity:0.75; }

.admin-only { display:none; }
body.admin .admin-only { display:block; }

.facility { font-size:13px; font-weight:700; margin-bottom:6px; }
.facility.trueleaf { color:#22c55e; }
.facility.motorcity { color:#38bdf8; }
.facility.elroya { color:#facc15; }

.log { border:1px solid #1e293b; border-radius:6px; padding:6px; font-size:12px; margin-top:6px; }
</style>
</head>
<body>

<div class="card">
<strong>Role:</strong> <span id="currentRole">Tech</span>
<button onclick="unlockAdmin()">Admin Unlock</button>
<button id="lockBtn" onclick="lockAdmin()" style="display:none;">Lock Admin</button>
</div>

<h1>Room Cycle Tracker</h1>

<div class="card">
<h2>Rooms</h2>
<div id="rooms"></div>
<button onclick="addRoom()">➕ Add Room</button>
</div>

<script>
/* ---------- Admin Lock ---------- */
let isAdmin=false;
function unlockAdmin(){
  const code=prompt("Enter admin code:");
  if(code==="420"){
    isAdmin=true;
    document.body.classList.add("admin");
    document.getElementById("currentRole").innerText="Admin";
    document.getElementById("lockBtn").style.display="inline";
  } else alert("Incorrect code");
}
function lockAdmin(){
  isAdmin=false;
  document.body.classList.remove("admin");
  document.getElementById("currentRole").innerText="Tech";
  document.getElementById("lockBtn").style.display="none";
}

/* ---------- Storage ---------- */
const ROOM_KEY="tracker_rooms_facility";
let rooms=JSON.parse(localStorage.getItem(ROOM_KEY))||[];

const FACILITIES=[
  {id:"trueleaf",name:"True Leaf"},
  {id:"motorcity",name:"Motor City"},
  {id:"elroya",name:"El Roya"}
];

/* ---------- Rooms ---------- */
function addRoom(){
  rooms.push({
    name:"Room "+(rooms.length+1),
    facility:"trueleaf",
    start:new Date().toISOString(),
    logs:{}
  });
  save(); render();
}

function dayInfo(start){
  const startDate=new Date(start);
  const now=new Date();
  const diff=Math.floor((now-startDate)/(1000*60*60*24));
  return {week:Math.floor(diff/7)+1,day:(diff%7)+1};
}

function addLog(i,mode){
  const r=rooms[i];
  if(!r.logs[mode]) r.logs[mode]={};
  const today=new Date().toLocaleDateString();
  if(r.logs[mode][today]) return alert("Entry already exists for this period today");
  const temp=prompt("Temp °F:");
  const rh=prompt("RH %:");
  const co2=prompt("CO₂ ppm:");
  r.logs[mode][today]={time:new Date().toLocaleTimeString(),temp,rh,co2};
  save(); render();
}

function renderRooms(){
  const div=document.getElementById("rooms");
  div.innerHTML="";
  FACILITIES.forEach(f=>{
    const group=rooms.filter(r=>r.facility===f.id);
    if(!group.length) return;
    div.innerHTML+=`<h3 class="facility ${f.id}">${f.name}</h3>`;
    group.forEach((r,i)=>{
      const idx=rooms.indexOf(r);
      const info=dayInfo(r.start);
      const today=new Date().toLocaleDateString();
      div.innerHTML+=`
      <div class="card">
        <input value="${r.name}" onchange="rooms[${idx}].name=this.value;save()">

        <div class="admin-only">
          <label>Facility</label>
          <select onchange="rooms[${idx}].facility=this.value;save();render()">
            ${FACILITIES.map(fa=>`<option value="${fa.id}" ${fa.id===r.facility?"selected":""}>${fa.name}</option>`).join("")}
          </select>
        </div>

        <p class="small">Week ${info.week} – Day ${info.day}</p>

        <div class="row">
          <button onclick="addLog(${idx},'day')">Add Day Entry</button>
          <button onclick="addLog(${idx},'night')">Add Night Entry</button>
        </div>

        <div class="log">
          <strong>Today</strong><br>
          Day: ${r.logs.day&&r.logs.day[today]?`${r.logs.day[today].temp}°F / ${r.logs.day[today].rh}% / ${r.logs.day[today].co2} ppm`:"—"}<br>
          Night: ${r.logs.night&&r.logs.night[today]?`${r.logs.night[today].temp}°F / ${r.logs.night[today].rh}% / ${r.logs.night[today].co2} ppm`:"—"}
        </div>
      </div>`;
    });
  });
}

/* ---------- Save / Render ---------- */
function save(){
  localStorage.setItem(ROOM_KEY,JSON.stringify(rooms));
}
function render(){
  renderRooms();
}
render();
</script>

</body>
</html>
