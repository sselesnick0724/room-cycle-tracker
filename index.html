<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Room Cycle Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#f4f6fb;margin:0;padding:16px}
h1,h2,h3{margin:8px 0}
.card{background:#fff;border-radius:14px;padding:16px;margin-bottom:16px;box-shadow:0 8px 20px rgba(0,0,0,.06)}
label{font-weight:600;display:block;margin-top:8px}
select,input,button{width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid #ccc}
button{background:#2563eb;color:#fff;border:none;font-weight:700}
.room{border-top:1px solid #eee;padding-top:10px;margin-top:10px}
.small{font-size:13px;color:#555}
</style>
</head>

<body>

<h1>Room Cycle Tracker</h1>

<div class="card">
<label>Active SOP</label>
<select id="sopSelect"></select>
<button onclick="createSOP()">Create New SOP</button>
</div>

<div class="card">
<h3>Add Room</h3>
<input id="roomName" placeholder="Room name / number">
<input id="plantCount" type="number" placeholder="Plant count">
<button onclick="addRoom()">Add Room</button>
</div>

<div class="card">
<h3>Rooms</h3>
<div id="rooms"></div>
</div>

<script>
/* ================= DATA ================= */
let store = JSON.parse(localStorage.getItem("RCT_STORE")) || {
sops:{},
rooms:[]
};

/* ============= DEFAULT SOP ============== */
if(!store.sops["True Leaf Fire"]){
store.sops["True Leaf Fire"]={
name:"True Leaf Fire",
weeks:[
{day:{t:82,rh:72,co2:1000},night:{t:78,rh:70,co2:1000}},
{day:{t:82,rh:72,co2:1000},night:{t:78,rh:70,co2:1000}},
{day:{t:80,rh:68,co2:1200},night:{t:70,rh:55,co2:1200}},
{day:{t:78,rh:66,co2:1200},night:{t:70,rh:55,co2:1200}},
{day:{t:77,rh:65,co2:1200},night:{t:68,rh:55,co2:1200}},
{day:{t:74,rh:55,co2:800}, night:{t:67,rh:40,co2:800}},
{day:{t:74,rh:50,co2:400}, night:{t:65,rh:35,co2:400}},
{day:{t:74,rh:50,co2:400}, night:{t:65,rh:35,co2:400}},
{day:{t:74,rh:50,co2:400}, night:{t:65,rh:35,co2:400}}
]
};
save();
}

/* ============= INIT UI ================== */
const sopSelect=document.getElementById("sopSelect");
function loadSOPs(){
sopSelect.innerHTML="";
Object.keys(store.sops).forEach(name=>{
let o=document.createElement("option");
o.textContent=name;
sopSelect.appendChild(o);
});
}
loadSOPs();

/* ============= CREATE SOP ================ */
function createSOP(){
let name=prompt("New SOP name");
if(!name || store.sops[name]) return;
store.sops[name]=JSON.parse(JSON.stringify(store.sops["True Leaf Fire"]));
save();
loadSOPs();
sopSelect.value=name;
}

/* ============= ADD ROOM ================= */
function addRoom(){
if(!sopSelect.value) return alert("Select SOP first");
if(!roomName.value || !plantCount.value) return alert("Fill all fields");
store.rooms.push({
name:roomName.value,
plants:plantCount.value,
sopName:sopSelect.value,
sopSnapshot:JSON.parse(JSON.stringify(store.sops[sopSelect.value])),
start:Date.now()
});
save();
renderRooms();
}

/* ============= RENDER ROOMS ============== */
function renderRooms(){
const r=document.getElementById("rooms");
r.innerHTML="";
store.rooms.forEach(room=>{
const d=document.createElement("div");
d.className="room";
d.innerHTML=`
<strong>${room.name}</strong><br>
<span class="small">
Plants: ${room.plants}<br>
SOP: ${room.sopName}
</span>
`;
r.appendChild(d);
});
}
renderRooms();

/* ============= SAVE ===================== */
function save(){
localStorage.setItem("RCT_STORE",JSON.stringify(store));
}
</script>

</body>
</html>
