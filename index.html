<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Room Cycle Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background:#f4f6fb;
  margin:0;
  padding:16px;
}

h1,h2,h3 { margin:0 0 8px }

.card {
  background:#fff;
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 8px 24px rgba(0,0,0,.06);
}

label { font-weight:600; display:block; margin-top:8px }
input, select, button {
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:16px;
}

button {
  background:#2563eb;
  color:#fff;
  border:none;
  margin-top:12px;
  font-weight:600;
}

.secondary { background:#555 }

.row {
  display:flex;
  gap:12px;
}

.col { flex:1 }

.target {
  background:#eef4ff;
  border-radius:10px;
  padding:12px;
}

.actual {
  background:#f9fafb;
  border-radius:10px;
  padding:12px;
}

.temp { color:#2563eb }
.rh { color:#dc2626 }

.vpd.green { color:#16a34a; font-weight:700 }
.vpd.yellow { color:#ca8a04; font-weight:700 }
.vpd.red { color:#dc2626; font-weight:700 }

.small { font-size:13px; opacity:.8 }

.hidden { display:none }

.back {
  background:#444;
}
</style>
</head>

<body>

<h1>Room Cycle Tracker</h1>

<div class="card">
<label>Facility</label>
<select id="facility">
  <option>True Leaf</option>
  <option>Motor City</option>
  <option>El Roya</option>
</select>
</div>

<div class="card">
<label>Active SOP</label>
<select id="sopSelect"></select>
<button onclick="toggleSopEditor()">Create / Edit SOP</button>
</div>

<div class="card hidden" id="sopEditor">
<h2>SOP Editor</h2>
<div id="sopWeeks"></div>
<button onclick="saveSOP()">Save SOP</button>
</div>

<div class="card">
<h2>Add Room</h2>
<label>Room</label>
<input id="roomName">
<label>Plant Count</label>
<input id="plantCount" type="number">
<label>Start Date</label>
<input id="startDate" type="date">
<button onclick="addRoom()">Add Room</button>
</div>

<div class="card">
<h2>Rooms</h2>
<div id="rooms"></div>
</div>

<div class="card hidden" id="roomView">
<button class="back" onclick="closeRoom()">← Back</button>
<h2 id="roomTitle"></h2>
<div id="roomWeeks"></div>
</div>

<script>
const SOP_RANGES = { min:1.0, max:1.4 }

function calcVPD(t, rh){
  const es = 0.6108 * Math.exp((17.27 * t)/(t+237.3))
  return ((1 - rh/100) * es).toFixed(2)
}

function vpdClass(v){
  if(v>=SOP_RANGES.min && v<=SOP_RANGES.max) return 'green'
  if(v>=0.8 && v<=1.6) return 'yellow'
  return 'red'
}

let sops = {
  "True Leaf Fire": {
    weeks: [
      { day:{t:82,rh:72,co2:1000}, night:{t:78,rh:70,co2:1000} },
      { day:{t:82,rh:72,co2:1000}, night:{t:78,rh:70,co2:1000} },
      { day:{t:82,rh:72,co2:1000}, night:{t:78,rh:70,co2:1000} },
      { day:{t:80,rh:68,co2:1200}, night:{t:70,rh:55,co2:1200} },
      { day:{t:78,rh:66,co2:1200}, night:{t:70,rh:55,co2:1200} },
      { day:{t:77,rh:65,co2:1200}, night:{t:68,rh:55,co2:1200} }
    ]
  }
}

let rooms = []
let activeRoom = null

function init(){
  const s = document.getElementById('sopSelect')
  s.innerHTML = Object.keys(sops).map(n=>`<option>${n}</option>`).join('')
}
init()

function toggleSopEditor(){
  const e=document.getElementById('sopEditor')
  e.classList.toggle('hidden')
  renderSopEditor()
}

function renderSopEditor(){
  const name=document.getElementById('sopSelect').value
  const w=document.getElementById('sopWeeks')
  w.innerHTML=''
  sops[name].weeks.forEach((wk,i)=>{
    w.innerHTML+=`
      <div class="card">
      <h3>Week ${i+1}</h3>
      Day: <input value="${wk.day.t}"> <input value="${wk.day.rh}"> <input value="${wk.day.co2}">
      Night: <input value="${wk.night.t}"> <input value="${wk.night.rh}"> <input value="${wk.night.co2}">
      </div>`
  })
}

function saveSOP(){ alert('SOP saved') }

function addRoom(){
  const r={
    name:roomName.value,
    plants:plantCount.value,
    start:startDate.value,
    sop:sopSelect.value,
    logs:[]
  }
  rooms.push(r)
  renderRooms()
}

function renderRooms(){
  roomsDiv.innerHTML=''
  rooms.forEach((r,i)=>{
    roomsDiv.innerHTML+=`
      <div class="card">
      <b>${r.name}</b><br>
      SOP: ${r.sop}<br>
      Plants: ${r.plants}<br>
      <button onclick="openRoom(${i})">View Room</button>
      </div>`
  })
}

function openRoom(i){
  activeRoom=i
  document.getElementById('roomView').classList.remove('hidden')
  renderRoom()
}

function closeRoom(){
  document.getElementById('roomView').classList.add('hidden')
}

function renderRoom(){
  const r=rooms[activeRoom]
  roomTitle.innerText=r.name
  roomWeeks.innerHTML=''
  const sop=sops[r.sop]

  sop.weeks.forEach((wk,i)=>{
    const vpd=calcVPD(wk.day.t,wk.day.rh)
    roomWeeks.innerHTML+=`
    <div class="card">
      <h3>Week ${i+1}</h3>
      <div class="row">
        <div class="col target">
          <b>Target DAY</b><br>
          <span class="temp">${wk.day.t}°F</span> /
          <span class="rh">${wk.day.rh}%</span> /
          ${wk.day.co2}ppm<br>
          <span class="vpd ${vpdClass(vpd)}">VPD ${vpd}</span>
        </div>
        <div class="col actual">
          <b>Actual</b><br>
          <input placeholder="Temp">
          <input placeholder="RH">
          <input placeholder="CO₂">
          <div class="small">Timestamp auto</div>
        </div>
      </div>
    </div>`
  })
}
</script>

</body>
</html>
