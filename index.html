<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Room Cycle Tracker</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background:#f4f6fb;
  margin:0;
  padding:16px;
}
h1 { font-size:28px; margin-bottom:12px; }
.card {
  background:#fff;
  border-radius:14px;
  padding:16px;
  margin-bottom:14px;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
}
label { font-weight:600; font-size:14px; }
input, select {
  width:100%;
  padding:10px;
  margin-top:6px;
  margin-bottom:10px;
  border-radius:10px;
  border:1px solid #ccc;
}
button {
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  background:#2563eb;
  color:#fff;
  font-weight:700;
  font-size:15px;
}
.room-card {
  padding:12px;
  border-top:1px solid #eee;
}
.target {
  background:#eef5ff;
  padding:10px;
  border-radius:10px;
}
.vpd-green { color:#16a34a; font-weight:700; }
.vpd-yellow { color:#ca8a04; font-weight:700; }
.vpd-red { color:#dc2626; font-weight:700; }
.small { font-size:13px; opacity:.8; }
.back {
  background:#e5e7eb;
  color:#000;
  margin-bottom:10px;
}
</style>
</head>

<body>

<h1>Room Cycle Tracker</h1>

<div class="card">
  <label>Facility</label>
  <select id="facility">
    <option>True Leaf</option>
    <option>Motor City</option>
    <option>El Roya</option>
  </select>
</div>

<div class="card">
  <label>Active SOP</label>
  <select id="sopSelect"></select>
</div>

<div class="card">
  <h3>Add Room</h3>
  <input id="roomName" placeholder="Room #" />
  <input id="plantCount" placeholder="Plant Count" type="number" />
  <label>Start Date</label>
  <input id="startDate" type="date" />
  <label>Light Schedule</label>
  <select id="light">
    <option value="12">12 / 12</option>
    <option value="18">18 / 6</option>
  </select>
  <button onclick="addRoom()">Add Room</button>
</div>

<div class="card">
  <h3>Rooms</h3>
  <div id="rooms"></div>
</div>

<script>
/* ---------------- SOP DATA ---------------- */

const sops = {
  "True Leaf Fire": {
    weeks: {
      1:{day:{t:82,rh:72,co2:1000},night:{t:78,rh:70,co2:1000}},
      2:{day:{t:82,rh:72,co2:1000},night:{t:78,rh:70,co2:1000}},
      3:{day:{t:82,rh:72,co2:1000},night:{t:78,rh:70,co2:1000}},
      4:{day:{t:80,rh:68,co2:1200},night:{t:70,rh:55,co2:1200}},
      5:{day:{t:78,rh:66,co2:1200},night:{t:70,rh:55,co2:1200}},
      6:{day:{t:77,rh:65,co2:1200},night:{t:68,rh:55,co2:1200}},
      7:{day:{t:74,rh:55,co2:800}, night:{t:67,rh:40,co2:800}},
      8:{day:{t:74,rh:50,co2:"Ambient"}, night:{t:65,rh:35,co2:"Ambient"}},
      9:{day:{t:74,rh:50,co2:"Ambient"}, night:{t:65,rh:35,co2:"Ambient"}}
    }
  }
};

/* ---------------- STATE ---------------- */

let rooms = [];

/* ---------------- INIT ---------------- */

const sopSelect = document.getElementById("sopSelect");
Object.keys(sops).forEach(s=>{
  const o=document.createElement("option");
  o.textContent=s;
  sopSelect.appendChild(o);
});

/* ---------------- VPD ---------------- */

function calcVPD(tempF, rh){
  const t=(tempF-32)*5/9;
  const es=0.6108*Math.exp((17.27*t)/(t+237.3));
  return ((1-rh/100)*es).toFixed(2);
}

function vpdClass(v){
  if(v>=1.0 && v<=1.4) return "vpd-green";
  if(v>=0.9 && v<=1.5) return "vpd-yellow";
  return "vpd-red";
}

/* ---------------- ROOMS ---------------- */

function addRoom(){
  const name=roomName.value;
  const plants=plantCount.value;
  const start=new Date(startDate.value);
  if(!name||!plants||!startDate.value) return alert("Fill all fields");
  rooms.push({
    name, plants, start,
    sop:sopSelect.value,
    logs:{}
  });
  renderRooms();
}

function renderRooms(){
  roomsDiv.innerHTML="";
  rooms.forEach((r,i)=>{
    const now=new Date();
    const days=Math.floor((now-r.start)/86400000);
    const week=Math.min(9,Math.max(1,Math.floor(days/7)+1));
    const phase=(now.getHours()>=6 && now.getHours()<18)?"day":"night";
    const target=sops[r.sop].weeks[week][phase];
    const vpd=calcVPD(target.t,target.rh);
    roomsDiv.innerHTML+=`
    <div class="room-card">
      <b>Room ${r.name}</b><br>
      SOP: ${r.sop}<br>
      Week ${week} · ${phase.toUpperCase()}<br>
      <div class="target">
        Target: ${target.t}°F / ${target.rh}% / ${target.co2} ppm<br>
        <span class="${vpdClass(vpd)}">VPD ${vpd}</span>
      </div>
    </div>`;
  });
}

const roomsDiv=document.getElementById("rooms");
</script>

</body>
</html>
