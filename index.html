<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Room Cycle Tracker</title>

<style>
:root {
--bg:#f4f6fb;
--card:#ffffff;
--primary:#2563eb;
--border:#e5e7eb;
--text:#111827;
--muted:#6b7280;
--green:#16a34a;
--red:#dc2626;
}

body {
font-family: system-ui, -apple-system, BlinkMacSystemFont;
background:var(--bg);
margin:0;
padding:16px;
color:var(--text);
}

h1,h2,h3 { margin:0 0 12px 0; }
.card {
background:var(--card);
border-radius:14px;
padding:16px;
margin-bottom:16px;
box-shadow:0 10px 30px rgba(0,0,0,.06);
}
label { font-weight:600; display:block; margin-bottom:4px; }
input,select,button {
width:100%;
padding:10px;
border-radius:10px;
border:1px solid var(--border);
margin-bottom:10px;
font-size:16px;
}
button {
background:var(--primary);
color:#fff;
border:none;
font-weight:700;
}
button.secondary {
background:#374151;
}
button.danger {
background:#b91c1c;
}
.row {
display:grid;
grid-template-columns:1fr 1fr;
gap:12px;
}
.small { font-size:13px; color:var(--muted); }

.vpd-ok { color:var(--green); font-weight:700; }
.vpd-bad { color:var(--red); font-weight:700; }

.room-card {
border-top:1px solid var(--border);
padding-top:12px;
margin-top:12px;
cursor:pointer;
}

.back {
background:#e5e7eb;
color:#111;
}

.hidden { display:none; }

</style>
</head>

<body>

<h1>Room Cycle Tracker</h1>

<!-- MODE -->
<div class="card">
<label>Mode</label>
<select id="mode">
<option>App</option>
<option>TV Wall</option>
</select>
</div>

<!-- FACILITY -->
<div class="card">
<label>Facility</label>
<select id="facility">
<option>True Leaf</option>
<option>Motor City</option>
<option>El Roya</option>
</select>
</div>

<!-- SOP -->
<div class="card">
<label>Active SOP</label>
<select id="sopSelect"></select>
<button onclick="openSOPEditor()">Create / Edit SOP</button>
</div>

<!-- ADD ROOM -->
<div class="card">
<h3>Add Room</h3>
<input id="roomName" placeholder="Room name / number" />
<input id="plantCount" type="number" placeholder="Plant count" />
<label>Start Date</label>
<input id="startDate" type="date" />
<label>Light Schedule</label>
<select id="light">
<option>12/12</option>
<option>18/6</option>
</select>
<button onclick="addRoom()">Add Room</button>
</div>

<!-- ROOMS -->
<div class="card">
<h3>Rooms</h3>
<div id="rooms"></div>
</div>

<!-- ROOM DETAIL -->
<div id="roomDetail" class="hidden"></div>

<script>
// ---------------- DATA ----------------
let data = JSON.parse(localStorage.getItem("tracker")) || {
sops:{},
rooms:{},
completed:[]
};

// True Leaf Fire SOP preload
if(!data.sops["True Leaf Fire"]) {
data.sops["True Leaf Fire"] = {
weeks:{
1:{day:{t:82,rh:72,co2:1000,vmin:1.0,vmax:1.2},night:{t:78,rh:70,co2:1000,vmin:0.9,vmax:1.1}},
2:{day:{t:82,rh:72,co2:1000,vmin:1.0,vmax:1.2},night:{t:78,rh:70,co2:1000,vmin:0.9,vmax:1.1}},
3:{day:{t:82,rh:72,co2:1000,vmin:1.0,vmax:1.2},night:{t:78,rh:70,co2:1000,vmin:0.9,vmax:1.1}},
4:{day:{t:80,rh:68,co2:1200,vmin:1.1,vmax:1.3},night:{t:70,rh:55,co2:1200,vmin:1.0,vmax:1.2}},
5:{day:{t:78,rh:66,co2:1200,vmin:1.1,vmax:1.3},night:{t:70,rh:55,co2:1200,vmin:1.0,vmax:1.2}},
6:{day:{t:77,rh:65,co2:1200,vmin:1.0,vmax:1.2},night:{t:68,rh:55,co2:1200,vmin:0.9,vmax:1.1}},
7:{day:{t:74,rh:55,co2:800,vmin:1.2,vmax:1.4},night:{t:67,rh:40,co2:800,vmin:1.3,vmax:1.5}},
8:{day:{t:74,rh:50,co2:400,vmin:1.3,vmax:1.5},night:{t:65,rh:35,co2:400,vmin:1.3,vmax:1.5}},
9:{day:{t:72,rh:45,co2:400,vmin:1.4,vmax:1.6},night:{t:64,rh:35,co2:400,vmin:1.4,vmax:1.6}}
}
};
}

// ---------------- HELPERS ----------------
function save() {
localStorage.setItem("tracker", JSON.stringify(data));
render();
}

function vpd(temp, rh) {
const es = 0.6108 * Math.exp((17.27 * temp) / (temp + 237.3));
const ea = es * (rh / 100);
return (es - ea).toFixed(2);
}

// ---------------- RENDER ----------------
function render() {
const sopSel = document.getElementById("sopSelect");
sopSel.innerHTML = "";
Object.keys(data.sops).forEach(s=>{
const o=document.createElement("option");
o.textContent=s;
sopSel.appendChild(o);
});

const roomBox = document.getElementById("rooms");
roomBox.innerHTML="";
Object.values(data.rooms).forEach(r=>{
const div=document.createElement("div");
div.className="room-card";
div.innerHTML=`
<strong>${r.name}</strong><br>
SOP: ${r.sop}<br>
Week ${r.week} · Day ${r.day}<br>
Target VPD ${r.targetVPD}
`;
div.onclick=()=>openRoom(r.id);
roomBox.appendChild(div);
});
}

function addRoom() {
const sop = sopSelect.value;
if(!sop) return alert("Select SOP first");
const id=Date.now();
data.rooms[id]={
id,
name:roomName.value,
plants:plantCount.value,
sop,
start:startDate.value,
week:1,
day:1,
targetVPD:data.sops[sop].weeks[1].day.vmin+"–"+data.sops[sop].weeks[1].day.vmax,
logs:{}
};
save();
}

// INIT
render();
</script>

</body>
</html>
