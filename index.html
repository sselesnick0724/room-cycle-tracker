<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Room Cycle Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial,sans-serif;background:#0f172a;color:#e5e7eb;margin:0;padding:16px}
h1,h2{margin:0 0 8px}
.card{background:#020617;border-radius:10px;padding:14px;margin-bottom:14px}
label{font-size:13px}
input,select,button{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:none}
button{background:#2563eb;color:#fff;font-weight:600}
button.disabled{background:#475569}
.row{display:flex;gap:8px}
.row>div{flex:1}
.small{font-size:12px;opacity:.8}
.admin-only{display:none}
body.admin .admin-only{display:block}
.hidden{display:none}
</style>
</head>
<body>

<div class="card">
<strong>Role:</strong> <span id="role">Tech</span>
<button onclick="unlock()">Admin Unlock</button>
<button id="lockBtn" onclick="lock()" style="display:none">Lock</button>
</div>

<h1>Room Cycle Tracker</h1>

<div class="card">
<h2>Facility</h2>
<select id="facilitySelect" onchange="renderRooms()">
<option>True Leaf</option>
<option>Motor City</option>
<option>El Roya</option>
</select>
</div>

<div class="card" id="sopSelectCard">
<h2>Active SOP</h2>
<select id="sopSelect"></select>
<div class="small">Select SOP â†’ then add rooms</div>
</div>

<div class="card admin-only hidden" id="sopEditorCard">
<h2>SOP Editor</h2>
<button onclick="toggleEditor()">Collapse SOP Editor</button>
<div id="sopEditor"></div>
</div>

<div class="card">
<h2>Rooms</h2>
<div id="rooms"></div>
<button id="addRoomBtn" onclick="addRoom()">Add Room</button>
</div>

<script>
let admin=false;
function unlock(){if(prompt("Code")==="420"){admin=true;document.body.classList.add("admin");role.innerText="Admin";lockBtn.style.display="inline"}}
function lock(){admin=false;document.body.classList.remove("admin");role.innerText="Tech";lockBtn.style.display="none";sopEditorCard.classList.add("hidden")}

const SOP_KEY="sops_fix",ROOM_KEY="rooms_fix";
let sops=JSON.parse(localStorage.getItem(SOP_KEY))||[
 {id:"default",name:"High Yield + Quality (9 Week)",archived:false}
];
let rooms=JSON.parse(localStorage.getItem(ROOM_KEY))||[];

function renderSOPs(){
 sopSelect.innerHTML="";
 sops.filter(s=>!s.archived).forEach(s=>{
  const o=document.createElement("option");
  o.value=s.id;o.textContent=s.name;
  sopSelect.appendChild(o);
 });
 toggleAddRoom();
}

sopSelect.onchange=()=>{
 toggleAddRoom();
 if(admin){sopEditorCard.classList.remove("hidden")}
};

function toggleEditor(){
 sopEditorCard.classList.add("hidden");
}

function toggleAddRoom(){
 const ok=!!sopSelect.value;
 addRoomBtn.disabled=!ok;
 addRoomBtn.className=ok?"":"disabled";
}

function addRoom(){
 if(!sopSelect.value)return alert("Select SOP first");
 rooms.push({
  name:"Room "+(rooms.length+1),
  facility:facilitySelect.value,
  sop:sopSelect.options[sopSelect.selectedIndex].text
 });
 save();renderRooms();
}

function renderRooms(){
 roomsDiv.innerHTML="";
 rooms.filter(r=>r.facility===facilitySelect.value).forEach(r=>{
  roomsDiv.innerHTML+=`<div class="card">
   <strong>${r.name}</strong>
   <div class="small">Facility: ${r.facility}</div>
   <div class="small">SOP: ${r.sop}</div>
  </div>`;
 });
}

function save(){
 localStorage.setItem(SOP_KEY,JSON.stringify(sops));
 localStorage.setItem(ROOM_KEY,JSON.stringify(rooms));
}

renderSOPs();renderRooms();
</script>
</body>
</html>
